# 教务系统需求分析文档

## 1. 文档目的与适用范围
- 明确“学生教务管理系统”的业务目标、业务流程及功能需求，为后续架构设计、开发实现和测试验收提供统一依据。
- 文档覆盖与 MySQL 现有数据结构相匹配的全部需求，严格遵循 `DESIGN.md`、`schema.sql` 中已定义的数据模型，不新增或变更库表结构。
- 主要面向产品、开发、测试、实施及运维角色；当需求更新时需同步维护本文件。

## 2. 项目背景与目标
- 背景：基于数据库课程实验要求，搭建一个能够演示 MySQL 数据建模与 SQL 增删改查能力的“学生教务管理系统”，后端参考 Flask 实现。
- 核心目标：
  - 覆盖学生、课程、选课、成绩、排课等核心业务，便于验证 CRUD、复杂查询、统计等 SQL 操作。
  - 通过业务规则（先修课、成绩等）展示约束、触发器及事务处理的综合运用。
  - 提供便于操作的基本界面或命令行工具，支撑课堂演示、实验报告与自测。

## 3. 术语说明与用户角色
### 3.1 术语
- 学年/学期：使用 `Year` 与 `TermDict.TermCode` 描述，例 `2025` 年 `Fall` 学期。
- 先修课：`Course.PrereqCno` 指向的课程，需先通过方能选修目标课程。
- 选课状态：`SC.Status`，包括 `enrolled`、`dropped`、`completed`。
- 成绩：`SC.Grade`（0~100 分），可结合 `GradeScale` 计算等级与绩点。
- 排课：`Teaching` 表示课程在某学期由具体教师、教室开设的教学安排。

### 3.2 用户角色
- 教务管理员：维护全校基础数据、审批排课与成绩变更。
- 院系秘书：负责本院学生、课程、教师信息维护及本院排课申请。
- 教师：查看授课安排、录入与调整课程成绩。
- 学生：查询个人课表、成绩，执行选课、退课等操作。
- 系统管理员：维护系统配置、账号权限、监控运行状态。

## 4. 系统范围与约束
- 必须覆盖学生、教师、课程、选课、排课、教室、院系相关业务流程。
- 数据持久化严格依托现有数据库结构，涉及约束（外键、触发器、索引）须遵循 `schema.sql` 与 `DESIGN.md`。
- 系统采用 B/S 架构，主要通过 Web 界面与 Flask API 交互；CLI 命令用于初始化与数据种子。

## 5. 功能需求
### 5.1 账户与权限
- 支持基础登录流程与角色识别（学生、教师、管理员），用于控制菜单入口与数据范围。
- 权限模型保持简洁，重点让不同角色在实验中演示到对应功能点。

### 5.2 基础字典管理
- `Department`、`TermDict` 数据应提供只读视图与管理员维护入口。
- 支持新增、编辑、禁用院系，并可查看关联的学生与课程数量。
- 学期字典维护仅限教务管理员，确保 `TermDict` 稳定。

### 5.3 学生管理（Student）
- 新增/编辑/查看学生基本信息，包含学号、姓名、性别、院系、入学年等。
- 支持批量导入（CSV/Excel），并进行字段格式校验与重复学号检测。
- 提供按院系、入学年、关键字的检索及分页展示；支持导出。
- 允许设置学生状态（例如启用/停用）以配合软删除或休学需求。

### 5.4 教师管理（Teacher）
- 维护教师个人信息、职称、所属院系及联系方式。
- 支持教师列表检索、排序与导出。
- 教师状态变化需同步影响排课可用性。

### 5.5 课程管理（Course）
- 维护课程基本属性、学分、课时、所属院系、是否开放等信息。
- 设置和调整先修课，系统需检测环路并提示（依据 `DESIGN.md` 提供的递归校验逻辑）。
- 支持课程多关键字搜索（依托 `FULLTEXT` 或 LIKE 模式），并可按院系、是否开放过滤。
- 提供课程历史开课统计视图：展示历年学期的选课人数、平均成绩、通过率。

### 5.6 排课与教室管理（Teaching、Classroom）
- 管理教室资源：楼宇、容量、唯一性校验。
- 排课流程：选择课程、教师、学年学期、教室与容量，校验教室容量。若需处理时间冲突，可通过额外字段或查询示例演示思路。
- 支持查看某课程或教师的授课安排，提供课表视图输出。
- 允许调整排课信息（教室、容量、日期范围）。

### 5.7 选课管理（SC）
- 学生选课：校验容量、冲突、先修课、重复选课、成绩未出等规则。
- 退课：更新 `SC.Status`，保留历史记录；退课后释放名额。
- 选课批处理：管理员可为班级批量选课或强制退课。
- 选课查询：支持按学年/学期、课程、教师、状态等筛选，并展示人数统计。

### 5.8 成绩管理
- 教师对已授课班级录入成绩，需要满足分值范围校验。
- 支持成绩批量导入、导出示例（可通过 CSV 脚本或 SQL 插入语句）。
- 成绩确认可采用简化流程：录入后由管理员复核并标记为 `completed`。
- 系统自动换算绩点与等级，提供学生学期 GPA、累计 GPA 可视化（依托 `v_student_term_gpa`、`v_student_cum_gpa`）。

### 5.9 报表与分析
- 提供学生维度的成绩分析（通过率、分布、趋势）。
- 课程难度画像：展示平均分、标准差、通过率、先修课对比（参照 `MORE.md` SQL 模板）。
- 院系层面统计学生人数、选课总量、教师授课负荷。
- 支持导出 CSV/Excel，支持图表组件集成。

### 5.10 全局检索
- 实现多关键字检索入口，覆盖学生、教师、课程、院系，结合 `FULLTEXT` 与 `v_search_entities`。
- 支持按照实体类型筛选与结果分页。

### 5.11 系统工具与 CLI
- 提供以下 CLI 命令并在文档中说明：
  - `init-db`：执行 `schema.sql` 初始化数据库。
  - `seed-demo`：导入示例数据集（学生、教师、课程、选课等），便于演示。
- CLI 保持逻辑简洁，聚焦于实验所需的建库与导入操作。

## 6. 业务规则与数据约束
- 学生、教师、课程、选课等 CRUD 操作必须遵循现有外键与约束：院系变更时同步 cascade 或置空。
- 先修课规则：选课或更新课程前校验是否修满先修课且成绩达标；触发器或业务逻辑保持一致。
- 成绩范围为 0~100；成绩空值表示未录入或未出。
- 选课主键 `(Sno, Cno)` 决定学生同一课程仅可存在一条记录；重修需通过退课或业务流程处理。
- 教室容量、课程容量等需结合 `Teaching.Capacity` 与实际选课人数控制。
- 数据更新需记录 `CreatedAt`/`UpdatedAt`（若已添加），用于排序与审计。

## 7. 业务流程概述
1. 基础数据准备：管理员创建院系、学期、教师、课程、教室。
2. 排课：院系秘书提交排课计划，教务管理员审批并生成 `Teaching` 记录。
3. 学生选课：学生在选课窗口内提交选课申请，系统校验并写入 `SC`。
4. 教师教学：依据排课安排开展教学，过程中可查看选课名单。
5. 成绩录入与审核：课程结束后教师录入成绩，经院系/教务审核后发布。
6. 报表分析：教务处定期导出统计报表，支持多维筛选。
7. 运维支持：管理员使用 CLI 初始化或重置测试数据。

## 8. 非功能性需求
- 性能：以教学演示为主，常用查询可依赖已有索引即可，无需专项性能优化。
- 可用性：界面或 CLI 需给出必要的提示与校验信息，确保实验过程顺畅即可。
- 安全性：演示环境采用简易登录机制即可，无需部署 HTTPS 或复杂审计方案。
- 可维护性：保持代码结构清晰、注释到位，方便同学理解和复现实验步骤。
- 可靠性：关键操作使用事务或触发器示例，展示数据一致性思路即可。
- 可扩展性：保留未来课程项目扩展的空间，但不强制实现高级特性。

## 9. 数据与迁移策略
- 初始化：使用 `schema.sql` 建库，`SC_data.sql` 等脚本可作为 demo 数据源。
- 迁移：实验阶段不开展正式数据库迁移，仅需手动维护脚本版本。
- 备份：实验环境下可按需导出 SQL 文件备份，便于复原。

## 10. 日志与审计
- 在应用层输出基础操作日志（如选课、成绩录入），便于课堂演示。
- 若使用 `UpdatedAt` 字段，可作为最近活动记录展示，无需构建复杂审计系统。
- 报错可通过 Flask 默认日志或终端输出来定位，满足实验调试即可。

## 11. 风险与待定事项
- 账号体系保持轻量，如需与学校统一认证集成可在后续扩展。
- 课程时间冲突检测需要更多时间/节次字段支撑，可作为进阶任务。
- 并发与容量控制仅需满足教学演示场景，高并发策略可在总结中提出思路。
- 绩点换算标准如与学校标准不一致，可在报告中说明并手动调整 `GradeScale`。

## 12. 交付与验收标准
- 功能验收：通过手工或脚本演示主要业务流（选课、成绩、排课、报表查询），展示 SQL 操作效果。
- 数据验收：利用示例数据验证先修校验、统计视图和复杂查询结果。
- 文档验收：补充实验报告所需的步骤说明、接口示例与查询脚本即可。
- 具备以上材料后，即可完成课程实验验收或提交成果。
